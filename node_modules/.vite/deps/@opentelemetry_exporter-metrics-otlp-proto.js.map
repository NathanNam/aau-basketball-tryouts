{
  "version": 3,
  "sources": ["../../.pnpm/@opentelemetry+exporter-metrics-otlp-http@0.208.0_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/exporter-metrics-otlp-http/src/OTLPMetricExporterOptions.ts", "../../.pnpm/@opentelemetry+exporter-metrics-otlp-http@0.208.0_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/exporter-metrics-otlp-http/src/OTLPMetricExporterBase.ts", "../../.pnpm/@opentelemetry+exporter-metrics-otlp-proto@0.208.0_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/exporter-metrics-otlp-proto/src/platform/browser/OTLPMetricExporter.ts"],
  "sourcesContent": ["/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { OTLPExporterConfigBase } from '@opentelemetry/otlp-exporter-base';\nimport {\n  AggregationTemporality,\n  AggregationSelector,\n} from '@opentelemetry/sdk-metrics';\n\nexport interface OTLPMetricExporterOptions extends OTLPExporterConfigBase {\n  temporalityPreference?:\n    | AggregationTemporalityPreference\n    | AggregationTemporality;\n  aggregationPreference?: AggregationSelector;\n}\n\nexport enum AggregationTemporalityPreference {\n  DELTA,\n  CUMULATIVE,\n  LOWMEMORY,\n}\n", "/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getStringFromEnv } from '@opentelemetry/core';\nimport {\n  AggregationTemporality,\n  AggregationTemporalitySelector,\n  InstrumentType,\n  PushMetricExporter,\n  ResourceMetrics,\n  AggregationSelector,\n  AggregationOption,\n  AggregationType,\n} from '@opentelemetry/sdk-metrics';\nimport {\n  AggregationTemporalityPreference,\n  OTLPMetricExporterOptions,\n} from './OTLPMetricExporterOptions';\nimport {\n  IOtlpExportDelegate,\n  OTLPExporterBase,\n} from '@opentelemetry/otlp-exporter-base';\nimport { diag } from '@opentelemetry/api';\n\nexport const CumulativeTemporalitySelector: AggregationTemporalitySelector =\n  () => AggregationTemporality.CUMULATIVE;\n\nexport const DeltaTemporalitySelector: AggregationTemporalitySelector = (\n  instrumentType: InstrumentType\n) => {\n  switch (instrumentType) {\n    case InstrumentType.COUNTER:\n    case InstrumentType.OBSERVABLE_COUNTER:\n    case InstrumentType.GAUGE:\n    case InstrumentType.HISTOGRAM:\n    case InstrumentType.OBSERVABLE_GAUGE:\n      return AggregationTemporality.DELTA;\n    case InstrumentType.UP_DOWN_COUNTER:\n    case InstrumentType.OBSERVABLE_UP_DOWN_COUNTER:\n      return AggregationTemporality.CUMULATIVE;\n  }\n};\n\nexport const LowMemoryTemporalitySelector: AggregationTemporalitySelector = (\n  instrumentType: InstrumentType\n) => {\n  switch (instrumentType) {\n    case InstrumentType.COUNTER:\n    case InstrumentType.HISTOGRAM:\n      return AggregationTemporality.DELTA;\n    case InstrumentType.GAUGE:\n    case InstrumentType.UP_DOWN_COUNTER:\n    case InstrumentType.OBSERVABLE_UP_DOWN_COUNTER:\n    case InstrumentType.OBSERVABLE_COUNTER:\n    case InstrumentType.OBSERVABLE_GAUGE:\n      return AggregationTemporality.CUMULATIVE;\n  }\n};\n\nfunction chooseTemporalitySelectorFromEnvironment() {\n  const configuredTemporality = (\n    getStringFromEnv('OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE') ??\n    'cumulative'\n  ).toLowerCase();\n\n  if (configuredTemporality === 'cumulative') {\n    return CumulativeTemporalitySelector;\n  }\n  if (configuredTemporality === 'delta') {\n    return DeltaTemporalitySelector;\n  }\n  if (configuredTemporality === 'lowmemory') {\n    return LowMemoryTemporalitySelector;\n  }\n\n  diag.warn(\n    `OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE is set to '${configuredTemporality}', but only 'cumulative' and 'delta' are allowed. Using default ('cumulative') instead.`\n  );\n  return CumulativeTemporalitySelector;\n}\n\nfunction chooseTemporalitySelector(\n  temporalityPreference?:\n    | AggregationTemporalityPreference\n    | AggregationTemporality\n): AggregationTemporalitySelector {\n  // Directly passed preference has priority.\n  if (temporalityPreference != null) {\n    if (temporalityPreference === AggregationTemporalityPreference.DELTA) {\n      return DeltaTemporalitySelector;\n    } else if (\n      temporalityPreference === AggregationTemporalityPreference.LOWMEMORY\n    ) {\n      return LowMemoryTemporalitySelector;\n    }\n    return CumulativeTemporalitySelector;\n  }\n\n  return chooseTemporalitySelectorFromEnvironment();\n}\n\nconst DEFAULT_AGGREGATION = Object.freeze({\n  type: AggregationType.DEFAULT,\n});\n\nfunction chooseAggregationSelector(\n  config: OTLPMetricExporterOptions | undefined\n): AggregationSelector {\n  return config?.aggregationPreference ?? (() => DEFAULT_AGGREGATION);\n}\n\nexport class OTLPMetricExporterBase\n  extends OTLPExporterBase<ResourceMetrics>\n  implements PushMetricExporter\n{\n  private readonly _aggregationTemporalitySelector: AggregationTemporalitySelector;\n  private readonly _aggregationSelector: AggregationSelector;\n\n  constructor(\n    delegate: IOtlpExportDelegate<ResourceMetrics>,\n    config?: OTLPMetricExporterOptions\n  ) {\n    super(delegate);\n    this._aggregationSelector = chooseAggregationSelector(config);\n    this._aggregationTemporalitySelector = chooseTemporalitySelector(\n      config?.temporalityPreference\n    );\n  }\n\n  selectAggregation(instrumentType: InstrumentType): AggregationOption {\n    return this._aggregationSelector(instrumentType);\n  }\n\n  selectAggregationTemporality(\n    instrumentType: InstrumentType\n  ): AggregationTemporality {\n    return this._aggregationTemporalitySelector(instrumentType);\n  }\n}\n", "/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { OTLPMetricExporterOptions } from '@opentelemetry/exporter-metrics-otlp-http';\nimport { OTLPMetricExporterBase } from '@opentelemetry/exporter-metrics-otlp-http';\nimport { OTLPExporterNodeConfigBase } from '@opentelemetry/otlp-exporter-base';\nimport { ProtobufMetricsSerializer } from '@opentelemetry/otlp-transformer';\nimport { createLegacyOtlpBrowserExportDelegate } from '@opentelemetry/otlp-exporter-base/browser-http';\n\nexport class OTLPMetricExporter extends OTLPMetricExporterBase {\n  constructor(\n    config: OTLPExporterNodeConfigBase & OTLPMetricExporterOptions = {}\n  ) {\n    super(\n      createLegacyOtlpBrowserExportDelegate(\n        config,\n        ProtobufMetricsSerializer,\n        'v1/metrics',\n        { 'Content-Type': 'application/x-protobuf' }\n      ),\n      config\n    );\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AA6BA,IAAY;CAAZ,SAAYA,mCAAgC;AAC1C,EAAAA,kCAAAA,kCAAA,OAAA,IAAA,CAAA,IAAA;AACA,EAAAA,kCAAAA,kCAAA,YAAA,IAAA,CAAA,IAAA;AACA,EAAAA,kCAAAA,kCAAA,WAAA,IAAA,CAAA,IAAA;AACF,GAJY,qCAAA,mCAAgC,CAAA,EAAA;;;ACQrC,IAAM,gCACX,MAAM,uBAAuB;AAExB,IAAM,2BAA2D,CACtE,mBACE;AACF,UAAQ,gBAAgB;IACtB,KAAK,eAAe;IACpB,KAAK,eAAe;IACpB,KAAK,eAAe;IACpB,KAAK,eAAe;IACpB,KAAK,eAAe;AAClB,aAAO,uBAAuB;IAChC,KAAK,eAAe;IACpB,KAAK,eAAe;AAClB,aAAO,uBAAuB;;AAEpC;AAEO,IAAM,+BAA+D,CAC1E,mBACE;AACF,UAAQ,gBAAgB;IACtB,KAAK,eAAe;IACpB,KAAK,eAAe;AAClB,aAAO,uBAAuB;IAChC,KAAK,eAAe;IACpB,KAAK,eAAe;IACpB,KAAK,eAAe;IACpB,KAAK,eAAe;IACpB,KAAK,eAAe;AAClB,aAAO,uBAAuB;;AAEpC;AAEA,SAAS,2CAAwC;AAC/C,QAAM,yBACJ,iBAAiB,mDAAmD,KACpE,cACA,YAAW;AAEb,MAAI,0BAA0B,cAAc;AAC1C,WAAO;;AAET,MAAI,0BAA0B,SAAS;AACrC,WAAO;;AAET,MAAI,0BAA0B,aAAa;AACzC,WAAO;;AAGT,OAAK,KACH,gEAAgE,qBAAqB,yFAAyF;AAEhL,SAAO;AACT;AAEA,SAAS,0BACP,uBAE0B;AAG1B,MAAI,yBAAyB,MAAM;AACjC,QAAI,0BAA0B,iCAAiC,OAAO;AACpE,aAAO;eAEP,0BAA0B,iCAAiC,WAC3D;AACA,aAAO;;AAET,WAAO;;AAGT,SAAO,yCAAwC;AACjD;AAEA,IAAM,sBAAsB,OAAO,OAAO;EACxC,MAAM,gBAAgB;CACvB;AAED,SAAS,0BACP,QAA6C;AAE7C,SAAO,QAAQ,0BAA0B,MAAM;AACjD;AAEM,IAAO,yBAAP,cACI,iBAAiC;EAGxB;EACA;EAEjB,YACE,UACA,QAAkC;AAElC,UAAM,QAAQ;AACd,SAAK,uBAAuB,0BAA0B,MAAM;AAC5D,SAAK,kCAAkC,0BACrC,QAAQ,qBAAqB;EAEjC;EAEA,kBAAkB,gBAA8B;AAC9C,WAAO,KAAK,qBAAqB,cAAc;EACjD;EAEA,6BACE,gBAA8B;AAE9B,WAAO,KAAK,gCAAgC,cAAc;EAC5D;;;;AChII,IAAOC,sBAAP,cAAkC,uBAAsB;EAC5D,YACE,SAAiE,CAAA,GAAE;AAEnE,UACE,sCACE,QACA,2BACA,cACA,EAAE,gBAAgB,yBAAwB,CAAE,GAE9C,MAAM;EAEV;;",
  "names": ["AggregationTemporalityPreference", "OTLPMetricExporter"]
}
